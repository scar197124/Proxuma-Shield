<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Proxuma Shield — Razor Prime (Full v6)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  * { box-sizing: border-box; }

  :root {
    --bg-color: #000000;
    --card-bg: #000000;
    --border-color: #00ff66;
    --text-color: #ffffff;
    --muted-color: rgba(245,245,245,0.7);
    --accent-color: #00ff66;
    --button-bg: #000000;
    --button-text: #00ff66;
    --button-border: #00ff66;
    --meter-border: #00ff66;
  }

  :root[data-theme="light"] {
    --bg-color: #ffffff;
    --card-bg: #ffffff;
    --border-color: #000000;
    --text-color: #000000;
    --muted-color: rgba(0,0,0,0.65);
    --accent-color: #000000;
    --button-bg: #ffffff;
    --button-text: #000000;
    --button-border: #000000;
    --meter-border: #000000;
  }

  body {
    background: var(--bg-color);
    color: var(--text-color);
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    margin:0;
    padding:0;
  }

  /* =========================
     HEADER (v3 style, refined)
     ========================= */
  #proxumaHeader {
    border-bottom: 2px solid var(--border-color);
    background: var(--bg-color);
    padding: 26px 60px 22px;
  }

  .core-row {
    display:grid;
    grid-template-columns: 1fr auto 1fr;
    align-items:center;
  }

  /* Move brand block outward from center (right-aligned on left column) */
  .brand-block {
    justify-self:end;
    text-align:right;
    padding-right: 84px;
  }

  .brand-title {
    font-size: 1.55rem;
    font-weight: 750;
    letter-spacing: 0.09em;
    text-transform: uppercase;
    color: var(--accent-color);
  }

  .brand-sub {
    font-size: 0.78rem;
    opacity: 0.78;
    margin-top: 2px;
    color: var(--muted-color);
  }

  .core-center { justify-self:center; }

  /* Proxuma button */
  .core-btn {
    border: 2px solid var(--border-color);
    background: transparent;
    color: var(--button-text);
    padding: 8px 28px;
    border-radius: 999px;
    font-size: 0.92rem;
    letter-spacing: 0.12em;
    cursor: pointer;
    transition: 0.18s ease;
  }

  .core-btn:hover {
    background: var(--accent-color);
    color: var(--bg-color);
    box-shadow: 0 0 14px rgba(0,255,102,0.22);
  }
  :root[data-theme="light"] .core-btn:hover {
    box-shadow: 0 0 10px rgba(0,0,0,0.18);
  }

  /* Theme toggle outward from center (left-aligned on right column) */
  .theme-toggle {
    justify-self:start;
    padding-left: 84px;
    display:flex;
    align-items:center;
    gap:10px;
    color: var(--text-color);
  }

  .theme-label {
    font-size: 0.86rem;
    opacity: 0.9;
    white-space: nowrap;
  }

  /* Switch */
  .switch {
    position: relative;
    display: inline-block;
    width: 40px;
    height: 22px;
  }
  .switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .slider {
    position: absolute;
    cursor: pointer;
    inset: 0;
    background-color: rgba(120,120,120,0.55);
    transition: 0.2s;
    border-radius: 999px;
    border: 1px solid var(--border-color);
  }
  .slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 3px;
    bottom: 3px;
    background-color: #ffffff;
    transition: 0.2s;
    border-radius: 50%;
    box-shadow: 0 0 3px rgba(0,0,0,0.4);
  }
  input:checked + .slider {
    background-color: rgba(10,10,10,0.15);
  }
  :root[data-theme="light"] input:checked + .slider {
    background-color: rgba(0,0,0,0.08);
  }
  input:checked + .slider:before {
    transform: translateX(18px);
  }

  /* Nav row centered on About */
  .nav-grid {
    margin-top: 24px;
    display:grid;
    grid-template-columns: 1fr auto 1fr;
    align-items:center;
  }
  .nav-left { justify-self: end; }
  .nav-center { justify-self: center; }
  .nav-right { justify-self: start; }

  .nav-grid button {
    border: 2px solid var(--border-color);
    background: transparent;
    color: var(--button-text);
    padding: 8px 20px;
    border-radius: 999px;
    font-size: 0.97rem;
    cursor:pointer;
    transition: 0.15s ease;
  }
  .nav-grid button:hover {
    background: var(--accent-color);
    color: var(--bg-color);
  }
  .nav-grid button.active {
    background: var(--accent-color);
    color: var(--bg-color);
    box-shadow: 0 0 10px rgba(0,255,102,0.33);
  }
  :root[data-theme="light"] .nav-grid button.active {
    box-shadow: 0 0 10px rgba(0,0,0,0.18);
  }

  /* =========================
     PAGE SECTIONS (Home/About/Scanner)
     ========================= */
  .page-section {
    max-width: 1100px;
    margin: 18px auto 0;
    padding: 22px 24px;
    border-radius: 14px;
    position: relative;
  }

  :root[data-theme="light"] .page-section {
    background: #ffffff;
    border: 2px solid #111;
    box-shadow: none;
  }

  :root:not([data-theme="light"]) .page-section {
    background: #000000;
    border: 2px solid var(--border-color);
    box-shadow:
      0 0 0 1px rgba(0,255,102,0.22),
      0 0 14px rgba(0,255,102,0.18);
  }

  /* HUD corner brackets */
  .page-section::before,
  .page-section::after {
    content: "";
    position: absolute;
    width: 18px;
    height: 18px;
    pointer-events: none;
  }
  .page-section::before {
    top: -2px;
    left: -2px;
    border-top: 2px solid;
    border-left: 2px solid;
  }
  .page-section::after {
    bottom: -2px;
    right: -2px;
    border-bottom: 2px solid;
    border-right: 2px solid;
  }
  :root[data-theme="light"] .page-section::before,
  :root[data-theme="light"] .page-section::after {
    border-color: #111;
  }
  :root:not([data-theme="light"]) .page-section::before,
  :root:not([data-theme="light"]) .page-section::after {
    border-color: var(--border-color);
    box-shadow: 0 0 6px rgba(0,255,102,0.55);
  }

  h1 { margin: 0 0 10px; font-size: 22px; }
  h2 { margin: 16px 0 10px; font-size: 16px; letter-spacing: 0.4px; }
  p.desc { margin: 0; color: var(--muted-color); font-size: 12.5px; line-height: 1.55; }

  .pill-row {
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    margin-top:10px;
  }
  .pill {
    font-size:11px;
    padding:4px 9px;
    border-radius:999px;
    border:1px solid var(--border-color);
    color: var(--muted-color);
    background: rgba(0,0,0,0.4);
  }
  :root[data-theme="light"] .pill { background:#f6f6f6; }

  .inline-link {
    border: none;
    background: none;
    color: var(--accent-color);
    text-decoration: underline;
    cursor: pointer;
    padding: 0;
    font: inherit;
  }
  .inline-link:hover { text-decoration: none; }
  .feature-list { padding-left: 1.2rem; margin: 8px 0; }
  .feature-list li { margin-bottom: 6px; }

  /* =========================
     SCANNER UI (Full Razor++)
     ========================= */
  .wrapper { max-width:1100px; margin:0 auto; padding:0; }
  .stacked { display:flex; flex-direction:column; gap:18px; }

  .section {
    background: radial-gradient(circle at top left,
      rgba(0,255,102,0.07),
      transparent 55%);
    background-color: var(--card-bg);
    padding:18px 18px 20px;
    border-radius:14px;
    border:2px solid var(--border-color);
    box-shadow:0 0 18px rgba(0,0,0,0.45);
    backdrop-filter: blur(6px);
  }
  :root[data-theme="light"] .section {
    background: #ffffff;
    box-shadow: none;
  }

  .section h2 { margin:0 0 8px; font-size:16px; letter-spacing:0.5px; }
  .section p.desc { margin:0 0 12px; font-size:12px; color: var(--muted-color); }

  label { display:block; margin:9px 0 5px; font-size:13px; opacity:0.9; }

  input, textarea, select {
    width:100%;
    padding:9px 10px;
    border-radius:9px;
    border:2px solid var(--border-color);
    background: rgba(0,0,0,0.75);
    color: var(--text-color);
    font-family:inherit;
    font-size:13px;
    outline:none;
  }
  :root[data-theme="light"] input,
  :root[data-theme="light"] textarea,
  :root[data-theme="light"] select {
    background:#f9f9f9;
    color:#000;
  }

  input:focus, textarea:focus, select:focus {
    box-shadow:0 0 0 1px var(--accent-color);
  }
  textarea { min-height:90px; resize:vertical; }

  .inline { display:flex; gap:10px; flex-wrap:wrap; }
  .inline > * { flex:1 1 120px; }

  button#scanBtn {
    margin-top:14px;
    width:100%;
    padding:10px 13px;
    background: var(--button-bg);
    color: var(--button-text);
    border:2px solid var(--button-border);
    border-radius:999px;
    font-size:14px;
    cursor:pointer;
    font-weight:600;
    letter-spacing:0.5px;
    transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.15s ease;
  }
  button#scanBtn:hover {
    background: rgba(0,0,0,0.85);
    box-shadow:0 0 10px rgba(0,255,102,0.2);
  }
  :root[data-theme="light"] button#scanBtn:hover {
    background:#f0f0f0;
    box-shadow:0 0 8px rgba(0,0,0,0.18);
  }
  button#scanBtn:active { transform:translateY(1px); }

  .status-bar { display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:4px; }
  .score { font-size:28px; font-weight:700; }

  .risk-tag {
    padding:5px 10px;
    border-radius:999px;
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:0.6px;
    border:2px solid var(--border-color);
  }
  .risk-low { background:rgba(0,255,102,0.12); }
  .risk-medium { background:rgba(210,160,0,0.12); }
  .risk-high { background:rgba(255,85,85,0.12); }

  :root[data-theme="light"] .risk-low { background:rgba(0,200,80,0.09); }
  :root[data-theme="light"] .risk-medium { background:rgba(210,160,0,0.12); }
  :root[data-theme="light"] .risk-high { background:rgba(200,40,40,0.13); }

  .meter-shell {
    margin-top:10px;
    width:100%;
    height:9px;
    border-radius:999px;
    background: rgba(0,0,0,0.7);
    overflow:hidden;
    border:2px solid var(--meter-border);
  }
  :root[data-theme="light"] .meter-shell { background:#f2f2f2; }

  .meter-fill {
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#00ff66,#a2ff00,#ffea00,#ff5555);
    transition:width 0.45s ease-out;
  }
  :root[data-theme="light"] .meter-fill {
    background:linear-gradient(90deg,#222,#666,#999,#000);
  }

  .mini-risk-grid { margin-top:12px; display:grid; grid-template-columns: 1fr; gap:6px; }
  .mini-risk-row { display:flex; align-items:center; gap:8px; font-size:11px; }
  .mini-risk-label { width:110px; color:var(--muted-color); }

  .mini-meter-shell {
    flex:1;
    height:6px;
    border-radius:999px;
    border:1px solid var(--meter-border);
    background:rgba(0,0,0,0.7);
    overflow:hidden;
  }
  :root[data-theme="light"] .mini-meter-shell { background:#f2f2f2; }

  .mini-meter-fill {
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#00ff66,#ffea00,#ff5555);
    transition:width 0.4s ease-out;
  }
  .mini-risk-value { width:42px; text-align:right; font-size:11px; }

  .meta-grid {
    display:grid;
    grid-template-columns:repeat(2,minmax(0,1fr));
    gap:10px;
    margin-top:10px;
  }
  .meta-box {
    background: rgba(0,0,0,0.6);
    border-radius:9px;
    padding:9px 10px;
    border:1px solid var(--border-color);
    font-size:11px;
  }
  :root[data-theme="light"] .meta-box { background:#fafafa; }

  .meta-label { color: var(--muted-color); margin-bottom:2px; }
  .meta-value { font-size:13px; }
  .chip {
    display:inline-block;
    font-size:10px;
    padding:3px 7px;
    border-radius:999px;
    border:1px solid var(--border-color);
    margin-top:4px;
    color: var(--muted-color);
  }

  .output-block {
    margin-top:10px;
    padding:9px 10px;
    border-radius:9px;
    background: rgba(0,0,0,0.7);
    border:1px solid var(--border-color);
    font-size:12px;
    line-height:1.5;
    color: var(--text-color);
  }
  :root[data-theme="light"] .output-block { background:#fafafa; color:#000; }

  .collapse-header {
    display:flex;
    align-items:center;
    justify-content:space-between;
    cursor:pointer;
    user-select:none;
  }
  .collapse-header .label {
    font-size:11px;
    color: var(--muted-color);
    text-transform:uppercase;
    letter-spacing:0.5px;
  }
  .chevron { font-size:14px; margin-left:8px; transition:transform 0.18s ease; }
  .collapse-body { margin-top:6px; font-size:12px; }
  .output-block.collapsed .collapse-body { display:none; }
  .output-block.collapsed .chevron { transform:rotate(-90deg); }
  .muted { color: var(--muted-color); }

  .history-wrapper { margin-top:18px; }
  .history-list {
    margin-top:8px;
    display:flex;
    flex-direction:column;
    gap:8px;
    max-height:260px;
    overflow-y:auto;
  }
  .history-item {
    border-radius:9px;
    border:1px solid var(--border-color);
    padding:7px 9px;
    background: rgba(0,0,0,0.65);
    font-size:11px;
  }
  :root[data-theme="light"] .history-item { background:#fbfbfb; }

  .history-top {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
    margin-bottom:2px;
  }
  .history-url {
    font-size:11px;
    overflow:hidden;
    text-overflow:ellipsis;
    white-space:nowrap;
  }
  .history-tag {
    font-size:10px;
    padding:2px 6px;
    border-radius:999px;
    border:1px solid var(--border-color);
  }
  .history-meta {
    font-size:10px;
    color: var(--muted-color);
    display:flex;
    justify-content:space-between;
    gap:6px;
    flex-wrap:wrap;
  }

  footer {
    padding:14px;
    text-align:center;
    font-size:11px;
    color: var(--muted-color);
    border-top:2px solid var(--border-color);
    background: var(--bg-color);
    margin-top: 22px;
  }

  @media (max-width: 900px) {
    #proxumaHeader { padding: 18px 16px 18px; }
    .core-row { grid-template-columns: 1fr; gap: 14px; text-align:center; }
    .brand-block { justify-self:center; text-align:center; padding-right:0; }
    .theme-toggle { justify-self:center; padding-left:0; }
    .nav-grid { grid-template-columns: 1fr; gap: 12px; }
    .nav-left, .nav-center, .nav-right { justify-self:center; }
    .meta-grid { grid-template-columns: 1fr; }
    .mini-risk-label { width: 98px; }
  }
</style>
</head>
<body>

<header id="proxumaHeader">
  <div class="core-row">
    <div class="brand-block">
      <div class="brand-title">Proxuma Shield</div>
      <div class="brand-sub">Razor Prime · Local-Only Defense</div>
    </div>

    <div class="core-center">
      <a href="https://scar197124.github.io/PROXUMA/" target="_blank" rel="noopener noreferrer" aria-label="Open Proxuma canonical site in a new tab">
        <button class="core-btn" id="proxumaCoreBtn" type="button">Proxuma</button>
      </a>
    </div>

    <div class="theme-toggle" title="Toggle theme">
      <label class="switch">
        <input type="checkbox" id="themeToggle">
        <span class="slider"></span>
      </label>
      <span class="theme-label" id="themeLabel">Neon Mode</span>
    </div>
  </div>

  <div class="nav-grid">
    <div class="nav-left"><button id="navHome" type="button">Home</button></div>
    <div class="nav-center"><button id="navAbout" type="button">About</button></div>
    <div class="nav-right"><button id="navScanner" type="button">Scanner</button></div>
  </div>
</header>

<main>
  <section id="home" class="page-section">
    <h1>Welcome to Proxuma Shield</h1>
    <p class="desc" style="margin-top:8px;">
      Proxuma Shield is a <strong>local-only</strong> protection layer for link and page-risk checking.
      Paste a URL, optionally add raw HTML, and Razor Prime will evaluate patterns associated with phishing,
      scams, credential traps, and look‑alike domains — <strong>without sending anything to the internet.</strong>
    </p>

    <div class="pill-row" style="margin-top:10px;">
      <div class="pill">No external requests</div>
      <div class="pill">Local-only heuristic analysis</div>
      <div class="pill">Razor++ Engine · Lookalike aware</div>
      <div class="pill">History stored locally</div>
    </div>

    <h2 style="margin-top:18px;">How to use it</h2>
    <ul class="feature-list">
      <li>Paste the link you were sent (email, DM, SMS, website).</li>
      <li>Choose a context profile (generic, login, payment, email) and sensitivity.</li>
      <li>Optional: paste raw HTML to detect forms, password fields, scripts, iframes, and sensitive keywords.</li>
      <li>Read the summary, verify the domain, and follow the recommended actions.</li>
    </ul>

    <h2 style="margin-top:16px;">Why it matters</h2>
    <p class="desc">
      Most modern attacks succeed because the page <em>looks</em> right while the URL is slightly wrong.
      Shield is built to make those subtle signals visible — fast — so you can decide before you click deeper.
    </p>

    <p class="desc" style="margin-top:12px;">
      Ready? Go to the <button class="inline-link" type="button" id="homeToScanner">Scanner</button>.
    </p>
  </section>

  <section id="about" class="page-section" style="display:none;">
    <h1>About Proxuma Shield</h1>
    <p class="desc" style="margin-top:8px;">
      Proxuma Shield is a privacy-first scanner designed to help you evaluate a link before you trust it.
      It scores risk using local heuristics only (no cloud lookups, no tracking).
    </p>

    <h2>What it checks</h2>
    <ul class="feature-list">
      <li>HTTPS vs non-HTTPS, suspicious TLDs, IP-host links, and subdomain tricks</li>
      <li>Redirect and obfuscation patterns (nested URLs, shorteners, encoding)</li>
      <li>Look-alike and leet-style brand impersonation signals</li>
      <li>Optional raw HTML signals (forms, password fields, scripts, iframes, sensitive keywords)</li>
      <li>Invisible characters / non-ASCII hostname risk (homoglyph patterns)</li>
      <li>High-entropy path/query patterns often used in exploit payloads</li>
    </ul>

    <h2>Local Context Awareness</h2>
    <p class="desc">
      If a link begins with <code>file://</code>, Shield treats it as <em>environmental sensitivity</em> rather than malicious network behavior,
      preventing false “100/100” alarms for local developer files.
    </p>

    <h2>Important note</h2>
    <p class="desc">
      This is a heuristic prototype. A low score does not guarantee safety.
      Always verify the domain and use strong caution before entering credentials or payments.
    </p>

    <p class="desc" style="margin-top:10px;">
      Go to the <button class="inline-link" type="button" id="aboutToScanner">Scanner</button> to run a check.
    </p>
  </section>

  <section id="scanner" class="page-section" style="display:none;">
    <div class="wrapper">
      <div class="stacked">
        <!-- INPUT -->
        <section class="section">
          <h2>Input Layer</h2>
          <p class="desc">
            Paste a URL and optional HTML. Razor++ runs local-only heuristic checks.
            Nothing is sent anywhere.
          </p>

          <label for="url">URL to analyze</label>
          <input id="url" type="text" placeholder="https://example.com/login">

          <div class="inline" style="margin-top:10px;">
            <div>
              <label for="profile">Context profile</label>
              <select id="profile">
                <option value="generic">Generic browsing</option>
                <option value="login">Login / account access</option>
                <option value="payment">Payment / checkout</option>
                <option value="email">Email link</option>
              </select>
            </div>
            <div>
              <label for="sensitivity">Data sensitivity</label>
              <select id="sensitivity">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
              </select>
            </div>
          </div>

          <label for="html">Paste raw HTML (optional)</label>
          <textarea id="html" placeholder="&lt;html&gt;...&lt;/html&gt;"></textarea>

          <label for="notes">Notes (optional)</label>
          <textarea id="notes" placeholder="Why are you checking this link? Any suspicious behavior? (kept local only)"></textarea>

          <button id="scanBtn" type="button">Run Razor++ Scan</button>

          <div class="pill-row">
            <div class="pill">No external requests</div>
            <div class="pill">Lookalike aware</div>
            <div class="pill">Split risk lanes</div>
            <div class="pill">Local history</div>
          </div>
        </section>

        <!-- SNAPSHOT -->
        <section class="section">
          <h2>Risk Snapshot</h2>
          <p class="desc">
            Overall risk score with separate threat lanes: credential theft, financial theft, and malware/exploit.
          </p>

          <div class="status-bar">
            <div>
              <div style="font-size:11px; color:var(--muted-color);">Overall risk score</div>
              <div class="score" id="scoreValue">–</div>
            </div>
            <div class="risk-tag" id="riskTag">Waiting for scan</div>
          </div>

          <div class="meter-shell"><div class="meter-fill" id="meterFill"></div></div>

          <div class="mini-risk-grid">
            <div class="mini-risk-row">
              <div class="mini-risk-label">Credential theft</div>
              <div class="mini-meter-shell"><div class="mini-meter-fill" id="credMeter"></div></div>
              <div class="mini-risk-value" id="credValue">–</div>
            </div>
            <div class="mini-risk-row">
              <div class="mini-risk-label">Financial theft</div>
              <div class="mini-meter-shell"><div class="mini-meter-fill" id="finMeter"></div></div>
              <div class="mini-risk-value" id="finValue">–</div>
            </div>
            <div class="mini-risk-row">
              <div class="mini-risk-label">Malware / exploit</div>
              <div class="mini-meter-shell"><div class="mini-meter-fill" id="malMeter"></div></div>
              <div class="mini-risk-value" id="malValue">–</div>
            </div>
          </div>

          <div class="meta-grid">
            <div class="meta-box">
              <div class="meta-label">Connection</div>
              <div class="meta-value" id="httpsMeta">–</div>
              <div class="chip" id="domainMeta">Domain: –</div>
            </div>
            <div class="meta-box">
              <div class="meta-label">Structure &amp; signals</div>
              <div class="meta-value" id="structureMeta">–</div>
              <div class="chip" id="extrasMeta">Signals: –</div>
            </div>
          </div>
        </section>

        <!-- EXPLAINERS -->
        <section class="section">
          <h2>Explainer Panels</h2>
          <p class="desc">
            Collapsible panels show: primary summary, detailed findings, and recommended actions.
          </p>

          <div class="output-block" id="summaryBlock">
            <div class="collapse-header" id="summaryHeader">
              <span class="label">Primary threat summary</span>
              <span class="chevron" id="summaryChevron">▾</span>
            </div>
            <div class="collapse-body"><span class="muted" id="summaryText">No scan yet. Provide a URL and run Razor++ Scan.</span></div>
          </div>

          <div class="output-block" id="detailsBlock">
            <div class="collapse-header" id="detailsHeader">
              <span class="label">Detailed findings</span>
              <span class="chevron" id="detailsChevron">▾</span>
            </div>
            <div class="collapse-body"><span class="muted" id="detailsText">Signals and flags will appear here after analysis.</span></div>
          </div>

          <div class="output-block" id="actionsBlock">
            <div class="collapse-header" id="actionsHeader">
              <span class="label">Recommended actions</span>
              <span class="chevron" id="actionsChevron">▾</span>
            </div>
            <div class="collapse-body"><span class="muted" id="actionsText">Safety guidance will appear here based on the risk level.</span></div>
          </div>
        </section>

        <!-- HISTORY -->
        <section class="section history-wrapper">
          <h2>Scan history (local)</h2>
          <p class="desc">Recent scans are stored only in this browser. Clear your storage to reset.</p>
          <div class="history-list" id="historyList">
            <div class="muted">No scans yet. Run a scan to see history here.</div>
          </div>
        </section>
      </div>
    </div>
  </section>
</main>

<footer>
  PROXUMA SHIELD · Razor Prime · Full v6 · Local-only heuristic prototype · Do not rely on this UI as a sole security decision-maker.
</footer>

<script>
  function showPage(id) {
    const pages = ["home","about","scanner"];
    pages.forEach(p => {
      const el = document.getElementById(p);
      if (el) el.style.display = (p === id) ? "" : "none";
    });

    const map = { home: "navHome", about: "navAbout", scanner: "navScanner" };
    Object.values(map).forEach(btnId => {
      const b = document.getElementById(btnId);
      if (b) b.classList.remove("active");
    });
    const activeBtn = document.getElementById(map[id]);
    if (activeBtn) activeBtn.classList.add("active");

    if (id === "scanner" && typeof renderHistory === "function") {
      try { renderHistory(); } catch (e) {}
    }
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  document.getElementById("navHome").addEventListener("click", () => showPage("home"));
  document.getElementById("navAbout").addEventListener("click", () => showPage("about"));
  document.getElementById("navScanner").addEventListener("click", () => showPage("scanner"));
  document.getElementById("homeToScanner").addEventListener("click", () => showPage("scanner"));
  document.getElementById("aboutToScanner").addEventListener("click", () => showPage("scanner"));

  // Theme toggle with persistence
  (function initThemeToggle() {
    const key = "proxuma_theme_v10";
    const saved = window.localStorage.getItem(key) || "neon";
    const toggle = document.getElementById("themeToggle");
    const label = document.getElementById("themeLabel");

    const isLight = saved === "light";
    document.documentElement.setAttribute("data-theme", isLight ? "light" : "neon");
    if (toggle) toggle.checked = isLight;
    if (label) label.textContent = isLight ? "Light Mode" : "Neon Mode";

    if (toggle) {
      toggle.addEventListener("change", function(){
        const val = this.checked ? "light" : "neon";
        document.documentElement.setAttribute("data-theme", val);
        if (label) label.textContent = this.checked ? "Light Mode" : "Neon Mode";
        try { window.localStorage.setItem(key, val); } catch (e) {}
      });
    }
  })();

  showPage("home");
</script>

<script>
// ---------- Utility helpers ----------
function looksLikeIP(host) {
  if (!host) return false;
  const parts = host.split(".");
  if (parts.length !== 4) return false;
  return parts.every(p => {
    const n = parseInt(p, 10);
    return !isNaN(n) && n >= 0 && n <= 255;
  });
}

function entropyScore(str) {
  if (!str) return 0;
  const s = String(str);
  const len = s.length;
  if (len < 12) return 0;
  const freq = {};
  for (let i = 0; i < len; i++) {
    const ch = s[i];
    freq[ch] = (freq[ch] || 0) + 1;
  }
  let entropy = 0;
  for (const ch in freq) {
    const p = freq[ch] / len;
    entropy -= p * Math.log2(p);
  }
  if (entropy < 3.5) return 0;
  if (entropy < 4.2) return 5;
  if (entropy < 4.8) return 10;
  return 15;
}

function hasZeroWidth(str) {
  if (!str) return false;
  return /[\u200B-\u200F\uFEFF]/.test(str);
}

function hasNonAsciiHostname(host) {
  if (!host) return false;
  for (let i = 0; i < host.length; i++) {
    if (host.charCodeAt(i) > 127) return true;
  }
  return false;
}

function hasFakeLockUnicode(str) {
  if (!str) return false;
  return /[\uD83D\uDD10\uD83D\uDD12]/.test(str);
}

function levenshtein(a, b) {
  if (!a) return b.length;
  if (!b) return a.length;
  const dp = Array(b.length + 1).fill(0).map(() => Array(a.length + 1).fill(0));
  for (let i = 0; i <= b.length; i++) dp[i][0] = i;
  for (let j = 0; j <= a.length; j++) dp[0][j] = j;
  for (let i = 1; i <= b.length; i++) {
    for (let j = 1; j <= a.length; j++) {
      if (b[i - 1] === a[j - 1]) dp[i][j] = dp[i - 1][j - 1];
      else dp[i][j] = Math.min(dp[i - 1][j] + 1, dp[i][j - 1] + 1, dp[i - 1][j - 1] + 1);
    }
  }
  return dp[b.length][a.length];
}

function normalizeLeet(str) {
  const map = { "0":"o", "1":"l", "3":"e", "4":"a", "5":"s", "7":"t", "8":"b" };
  let out = "";
  for (let i = 0; i < str.length; i++) out += map[str[i]] || str[i];
  return out;
}

function leetSubCount(original, normalized) {
  let count = 0;
  const len = Math.min(original.length, normalized.length);
  for (let i = 0; i < len; i++) if (original[i] !== normalized[i]) count++;
  return count;
}

// ---------- URL analysis ----------
function analyzeUrl(url) {
  const info = {
    valid:false, https:false, host:"", tld:"", path:"", length:url ? url.length : 0,
    isIP:false, hasManySubdomains:false, hasSuspiciousTLD:false, hasLoginWords:false,
    trackingParams:false, brandHit:false, obfuscationFlags:[], entropyBoost:0,
    repeatedWords:false, hasZeroWidth:false, hasNonAsciiHost:false, hasFakeLock:false,
    leetSubCount:0, brandLeetImpersonation:false, wordLikeLeet:false, raw:url || "",
    contextType:"network"
  };

  if (!url) return info;

  try {
    const u = new URL(url);
    info.valid = true;
    if (u.protocol === "file:") info.contextType = "local-file";
    info.https = (u.protocol === "https:");
    info.host = u.hostname || "";
    info.path = u.pathname || "/";
    info.length = url.length;
    info.isIP = looksLikeIP(info.host);

    const hostParts = info.host.split(".");
    if (hostParts.length > 3) info.hasManySubdomains = true;
    const tld = hostParts[hostParts.length - 1].toLowerCase();
    info.tld = tld;

    const suspiciousTLDs = ["ru","cn","tk","gq","ml","ga","cf","work","zip","lol"];
    info.hasSuspiciousTLD = suspiciousTLDs.includes(tld);

    const lowerUrl = url.toLowerCase();
    const loginWords = ["login","signin","verify","reset","account","wallet","secure",
                        "update","security","check","password","auth","session"];
    info.hasLoginWords = loginWords.some(w => lowerUrl.includes(w));

    info.trackingParams = lowerUrl.includes("utm_") ||
                          lowerUrl.includes("gclid") ||
                          lowerUrl.includes("fbclid") ||
                          lowerUrl.includes("ref=") ||
                          lowerUrl.includes("campaign=");

    const hostLower = info.host.toLowerCase();
    const brandKeywords = [
      "google","paypal","apple","microsoft","facebook","meta","amazon","netflix",
      "bankofamerica","chase","td","rbc","gmail","outlook","yahoo","instagram",
      "telegram","whatsapp","binance","coinbase","twitter","x.com"
    ];
    info.brandHit = brandKeywords.some(b => hostLower.includes(b));

    const obf = [];
    if (url.includes("@")) obf.push("contains @ in URL");
    if (url.includes("%")) obf.push("percent-encoding present");
    if (url.includes("\\x")) obf.push("hex-style escapes");
    if (lowerUrl.includes("://bit.ly") ||
        lowerUrl.includes("://t.co") ||
        lowerUrl.includes("://tinyurl") ||
        lowerUrl.includes("://goo.gl")) {
      obf.push("shortener-style URL");
    }
    if (lowerUrl.includes("redirect=") || lowerUrl.includes("redir=")) obf.push("redirect parameter");
    if (lowerUrl.includes("url=") && lowerUrl.includes("http")) obf.push("nested URL parameter");
    info.obfuscationFlags = obf;

    const pathBits = info.path.split(/[-/_]+/).filter(Boolean);
    const wordCounts = {};
    pathBits.forEach(w => {
      const lw = w.toLowerCase();
      wordCounts[lw] = (wordCounts[lw] || 0) + 1;
    });
    info.repeatedWords = Object.values(wordCounts).some(c => c >= 3);

    const entropyTarget = (u.search || "") + "|" + (u.pathname || "");
    info.entropyBoost = entropyScore(entropyTarget);

    info.hasZeroWidth = hasZeroWidth(url);
    info.hasNonAsciiHost = hasNonAsciiHostname(info.host);
    info.hasFakeLock = hasFakeLockUnicode(url);

    const hostNorm = normalizeLeet(hostLower);
    const subCount = leetSubCount(hostLower, hostNorm);
    info.leetSubCount = subCount;

    const sld = hostLower.split(".").slice(-2, -1)[0] || "";
    const sldNorm = normalizeLeet(sld);
    if (sldNorm.match(/^[a-z]{5,}$/) && sldNorm !== sld) info.wordLikeLeet = true;

    for (const brand of brandKeywords) {
      if (hostNorm.includes(brand) && !hostLower.includes(brand)) {
        const dist = levenshtein(hostNorm, brand);
        if (dist <= 3) { info.brandLeetImpersonation = true; break; }
      }
    }
  } catch (e) {}

  return info;
}

// ---------- HTML analysis ----------
function analyzeHtml(html) {
  const res = { present:false, forms:0, passwordFields:0, scriptTags:0, iframes:0, dangerousWords:[] };
  if (!html || !html.trim()) return res;
  res.present = true;

  const lower = html.toLowerCase();
  const matches = (pattern) => (lower.match(pattern) || []).length;

  res.forms = matches(/<form\b/gi);
  res.passwordFields = matches(/type=["']password["']/gi);
  res.scriptTags = matches(/<script\b/gi);
  res.iframes = matches(/<iframe\b/gi);

  const dangerList = [
    "crypto","seed phrase","metamask","bank","credit card",
    "2fa","one-time code","social security","private key","wallet","mnemonic"
  ];
  res.dangerousWords = dangerList.filter(w => lower.includes(w));

  return res;
}

// ---------- Scoring engine v6 (Razor++) ----------
function computeScore(urlInfo, htmlInfo, context) {
  let score = 5;

  if (!urlInfo.valid && urlInfo.raw) score += 24;
  if (urlInfo.valid && !urlInfo.https) score += 22;

  if (urlInfo.hasSuspiciousTLD) score += 30;
  if (urlInfo.isIP) score += 15;
  if (urlInfo.hasManySubdomains) score += 13;
  if (urlInfo.length > 120) score += 8;
  if (urlInfo.length > 220) score += 8;

  if (urlInfo.hasLoginWords) score += 21;
  if (urlInfo.trackingParams) score += 4;
  if (urlInfo.brandHit) score += 12;

  if (urlInfo.obfuscationFlags.length > 0) score += Math.min(8 + urlInfo.obfuscationFlags.length * 4, 20);
  score += urlInfo.entropyBoost;

  if (urlInfo.repeatedWords) score += 8;
  if (urlInfo.hasZeroWidth) score += 12;
  if (urlInfo.hasNonAsciiHost) score += 10;
  if (urlInfo.hasFakeLock) score += 10;

  if (htmlInfo.present) {
    score += htmlInfo.forms * 4;
    score += htmlInfo.passwordFields * 11;
    score += Math.min(htmlInfo.scriptTags * 3, 15);
    score += Math.min(htmlInfo.iframes * 4, 18);
    score += htmlInfo.dangerousWords.length * 8;
  }

  if (urlInfo.brandLeetImpersonation) score += 40;
  if (urlInfo.wordLikeLeet && urlInfo.leetSubCount >= 1) score += 12;
  if (urlInfo.leetSubCount >= 2) score += 6;

  // Split threat lanes
  let credScore = 0, financialScore = 0, malwareScore = 0;

  if (urlInfo.hasLoginWords || htmlInfo.passwordFields > 0) credScore += 25;
  if (urlInfo.brandHit && urlInfo.hasLoginWords) credScore += 20;
  if (htmlInfo.dangerousWords.length > 0) credScore += 10;
  if (urlInfo.brandLeetImpersonation) credScore += 25;

  if (urlInfo.hasSuspiciousTLD) financialScore += 15;
  if (htmlInfo.dangerousWords.some(w => w === "bank" || w === "credit card")) financialScore += 20;
  if (context.profile === "payment") financialScore += 15;

  if (urlInfo.entropyBoost >= 10 || urlInfo.obfuscationFlags.length > 0) malwareScore += 20;
  if (htmlInfo.scriptTags > 4 || htmlInfo.iframes > 2) malwareScore += 15;

  // Sensitivity multipliers
  if (context.sensitivity === "high") {
    credScore *= 1.2; financialScore *= 1.2;
  }

  let multiplier = 1.0;
  if (context.sensitivity === "high") multiplier *= 1.2;
  if (context.profile === "payment") multiplier *= 1.25;
  if (context.profile === "login") multiplier *= 1.15;
  if (context.profile === "email") multiplier *= 1.2;

  score *= multiplier;

  // Red-flag escalation
  let redFlags = 0;
  if (urlInfo.hasSuspiciousTLD) redFlags++;
  if (urlInfo.hasManySubdomains) redFlags++;
  if (urlInfo.hasLoginWords) redFlags++;
  if (urlInfo.brandHit) redFlags++;
  if (urlInfo.obfuscationFlags.length > 0) redFlags++;
  if (urlInfo.entropyBoost >= 10) redFlags++;
  if (urlInfo.hasNonAsciiHost || urlInfo.hasZeroWidth) redFlags++;
  if (urlInfo.brandLeetImpersonation || urlInfo.wordLikeLeet) redFlags++;

  if (redFlags >= 3) score *= 1.12;
  if (redFlags >= 4) score *= 1.22;
  if (redFlags >= 5) score *= 1.32;

  // Minimum floors for combinations
  let minScore = 0;
  if (urlInfo.hasSuspiciousTLD && urlInfo.hasManySubdomains) minScore = Math.max(minScore, 72);
  if (urlInfo.hasSuspiciousTLD && urlInfo.hasLoginWords) minScore = Math.max(minScore, 78);
  if (urlInfo.hasSuspiciousTLD && urlInfo.brandHit && (urlInfo.hasLoginWords || urlInfo.hasManySubdomains)) minScore = Math.max(minScore, 92);
  if (urlInfo.brandHit && urlInfo.hasLoginWords && (urlInfo.obfuscationFlags.length > 0 || urlInfo.entropyBoost >= 10)) minScore = Math.max(minScore, 88);
  if (urlInfo.brandLeetImpersonation) minScore = Math.max(minScore, 90);

  // If only HTML (no URL), cap intensity
  if (!urlInfo.raw && htmlInfo.present) if (score > 60) score = 60;

  if (score < minScore) score = minScore;

  // Local file context cap
  if (urlInfo.contextType === "local-file") if (score > 50) score = 50;

  score = Math.max(0, Math.min(100, score));

  return {
    total: Math.round(score),
    credential: Math.round(Math.max(0, Math.min(100, credScore))),
    financial: Math.round(Math.max(0, Math.min(100, financialScore))),
    malware: Math.round(Math.max(0, Math.min(100, malwareScore)))
  };
}

function riskLabel(score) {
  if (score < 35) return { label: "Low", css: "risk-low" };
  if (score < 70) return { label: "Medium", css: "risk-medium" };
  return { label: "High", css: "risk-high" };
}

function summarize(urlInfo, htmlInfo, scores) {
  const score = scores.total;
  if (!urlInfo.raw) return "No URL provided. Enter a URL and run Razor++ Scan to generate a risk snapshot.";

  const base = `This link was evaluated using local heuristic checks only. The current risk score is ${score}/100.`;

  if (!urlInfo.valid) return base + " The URL could not be parsed reliably, which itself may indicate tampering or copy-paste errors. Treat with caution.";

  if (urlInfo.contextType === "local-file") return base + " This link points to a local file on your device. The score reflects environmental sensitivity rather than malicious network behavior.";

  const parts = [];

  if (!urlInfo.https) parts.push("The connection is not using HTTPS, so data in transit could potentially be intercepted or modified.");
  else parts.push("The connection is using HTTPS, which helps protect data in transit, but does not guarantee the site is trustworthy.");

  if (urlInfo.hasSuspiciousTLD) parts.push("The top-level domain is associated with higher abuse rates or disposable hosting.");
  if (urlInfo.isIP) parts.push("The link goes directly to an IP address rather than a named domain, which is unusual for mainstream services.");
  if (urlInfo.hasManySubdomains) parts.push("The domain contains multiple nested subdomains, which attackers sometimes use to mimic legitimate brands.");
  if (urlInfo.brandHit) parts.push("The hostname appears to reference a well-known brand, which can be used in phishing to create a false sense of legitimacy.");
  if (urlInfo.hasLoginWords) parts.push("The URL path or query suggests login, account, or security activity, which raises the impact if this link is malicious.");
  if (urlInfo.obfuscationFlags.length) parts.push("Obfuscation or redirection-style patterns detected: " + urlInfo.obfuscationFlags.join(", ") + ".");
  if (urlInfo.entropyBoost >= 10) parts.push("The structure of the path or query parameters appears highly random, which is common in tracking or exploit payloads.");
  if (urlInfo.hasZeroWidth || urlInfo.hasNonAsciiHost) parts.push("The domain or URL contains invisible or non-standard characters, which can be used for lookalike or homoglyph attacks.");
  if (urlInfo.wordLikeLeet) parts.push("The domain resembles a word but uses letter-to-number substitutions, which is a common lookalike pattern.");
  if (urlInfo.brandLeetImpersonation) parts.push("The domain appears to imitate a well-known brand name using character substitutions, a strong phishing indicator.");

  if (htmlInfo.present) {
    if (htmlInfo.passwordFields > 0) parts.push("The HTML appears to contain password input fields.");
    if (htmlInfo.scriptTags > 0) parts.push("The page includes active scripts that could modify content or capture data.");
    if (htmlInfo.iframes > 0) parts.push("Embedded iframes are present, which can be used for tracking, overlays, or hidden content injection.");
    if (htmlInfo.dangerousWords.length > 0) parts.push("Sensitive finance or wallet-related keywords detected in the HTML: " + htmlInfo.dangerousWords.join(", ") + ".");
  }

  if (!parts.length) parts.push("No strong red-flag patterns were detected by this prototype, but this does not guarantee safety.");

  return base + " " + parts.join(" ");
}

function buildDetailsText(urlInfo, htmlInfo, scores) {
  const lines = [];
  lines.push("Risk profile:");
  lines.push("  • Credential theft risk: " + scores.credential + "/100");
  lines.push("  • Financial theft risk: " + scores.financial + "/100");
  lines.push("  • Malware / exploit risk: " + scores.malware + "/100");
  lines.push("");
  lines.push("URL analysis:");
  lines.push("  • Parsed: " + (urlInfo.valid ? "yes" : "no"));
  lines.push("  • HTTPS: " + (urlInfo.https ? "yes" : "no"));
  lines.push("  • Host: " + (urlInfo.host || "–"));
  lines.push("  • TLD: " + (urlInfo.tld || "–"));
  lines.push("  • Path: " + (urlInfo.path || "–"));
  lines.push("  • Length: " + urlInfo.length + " characters");
  lines.push("  • Uses IP as host: " + (urlInfo.isIP ? "yes" : "no"));
  lines.push("  • Many subdomains: " + (urlInfo.hasManySubdomains ? "yes" : "no"));
  lines.push("  • Suspicious TLD: " + (urlInfo.hasSuspiciousTLD ? "yes" : "no"));
  lines.push("  • Brand-like hostname: " + (urlInfo.brandHit ? "yes" : "no"));
  lines.push("  • Login / security words: " + (urlInfo.hasLoginWords ? "yes" : "no"));
  lines.push("  • Tracking parameters: " + (urlInfo.trackingParams ? "yes" : "no"));
  lines.push("  • Obfuscation signals: " + (urlInfo.obfuscationFlags.length ? urlInfo.obfuscationFlags.join(", ") : "none"));
  lines.push("  • High-entropy pattern boost: " + urlInfo.entropyBoost);
  lines.push("  • Zero-width characters in URL: " + (urlInfo.hasZeroWidth ? "yes" : "no"));
  lines.push("  • Non-ASCII characters in host: " + (urlInfo.hasNonAsciiHost ? "yes" : "no"));
  lines.push("  • Leet substitutions in host: " + urlInfo.leetSubCount);
  lines.push("  • Word-like with substitutions: " + (urlInfo.wordLikeLeet ? "yes" : "no"));
  lines.push("  • Brand leet impersonation: " + (urlInfo.brandLeetImpersonation ? "yes" : "no"));
  lines.push("");
  lines.push("HTML analysis:");
  lines.push("  • Provided: " + (htmlInfo.present ? "yes" : "no"));
  if (htmlInfo.present) {
    lines.push("  • <form> tags: " + htmlInfo.forms);
    lines.push("  • password-type inputs: " + htmlInfo.passwordFields);
    lines.push("  • <script> tags: " + htmlInfo.scriptTags);
    lines.push("  • <iframe> tags: " + htmlInfo.iframes);
    lines.push("  • Sensitive keywords: " + (htmlInfo.dangerousWords.length ? htmlInfo.dangerousWords.join(", ") : "none"));
  } else {
    lines.push("  • No HTML body was provided for inspection.");
  }
  return lines.join("\n");
}

function buildActionsText(score) {
  const baseAdvice = [
    "• Never enter passwords, recovery phrases, or payment details on a page you do not fully trust.",
    "• When in doubt, navigate to the site manually instead of clicking on links from email or chat.",
    "• Compare the domain carefully against the official site (extra letters, dashes, or strange endings can indicate phishing)."
  ];

  if (score >= 70) {
    return [
      "This prototype flags the link as HIGH RISK based on the observable patterns.",
      "Recommended actions:",
      "• Avoid entering any personal or financial information on this page.",
      "• Close the tab and, if this appeared in an email or message, treat the message as suspicious.",
      "• If this claims to be from a known service (bank, email, wallet), go directly to the official site instead.",
      "",
      ...baseAdvice
    ].join("\n");
  } else if (score >= 35) {
    return [
      "This prototype flags the link as MEDIUM RISK. Several caution signals are present.",
      "Recommended actions:",
      "• Proceed only if you initiated this action and you fully trust the source.",
      "• Double-check the domain spelling and the page content for anything unusual.",
      "",
      ...baseAdvice
    ].join("\n");
  } else {
    return [
      "This prototype flags the link as LOW RISK based on its limited heuristic checks.",
      "However, low risk does NOT mean no risk.",
      "Recommended actions:",
      "• Continue to apply normal caution and verify the site before entering sensitive information.",
      "",
      ...baseAdvice
    ].join("\n");
  }
}

// ---------- History handling ----------
function loadHistory() {
  try {
    const raw = window.localStorage.getItem("proxuma_history_v10");
    if (!raw) return [];
    const parsed = JSON.parse(raw);
    if (!Array.isArray(parsed)) return [];
    return parsed;
  } catch (e) {
    return [];
  }
}

function saveHistory(list) {
  try { window.localStorage.setItem("proxuma_history_v10", JSON.stringify(list)); } catch (e) {}
}

function renderHistory() {
  const container = document.getElementById("historyList");
  const history = loadHistory();
  container.innerHTML = "";
  if (!history.length) {
    const div = document.createElement("div");
    div.className = "muted";
    div.textContent = "No scans yet. Run a scan to see history here.";
    container.appendChild(div);
    return;
  }

  history.forEach(item => {
    const card = document.createElement("div");
    card.className = "history-item";

    const top = document.createElement("div");
    top.className = "history-top";

    const urlSpan = document.createElement("div");
    urlSpan.className = "history-url";
    urlSpan.textContent = item.url || "(no URL)";

    const tag = document.createElement("div");
    tag.className = "history-tag";
    tag.textContent = item.level + " · " + item.score;

    top.appendChild(urlSpan);
    top.appendChild(tag);

    const meta = document.createElement("div");
    meta.className = "history-meta";
    const left = document.createElement("span");
    left.textContent = "Domain: " + (item.domain || "–");
    const right = document.createElement("span");
    right.textContent = item.time;
    meta.appendChild(left);
    meta.appendChild(right);

    card.appendChild(top);
    card.appendChild(meta);
    container.appendChild(card);
  });
}

// ---------- Collapse toggles ----------
function toggleBlock(id) {
  const block = document.getElementById(id + "Block");
  if (!block) return;
  block.classList.toggle("collapsed");
}

document.getElementById("summaryHeader").addEventListener("click", function () { toggleBlock("summary"); });
document.getElementById("detailsHeader").addEventListener("click", function () { toggleBlock("details"); });
document.getElementById("actionsHeader").addEventListener("click", function () { toggleBlock("actions"); });

renderHistory();

// ---------- Scan handler ----------
document.getElementById("scanBtn").addEventListener("click", function () {
  const url = document.getElementById("url").value.trim();
  const html = document.getElementById("html").value;
  const profile = document.getElementById("profile").value;
  const sensitivity = document.getElementById("sensitivity").value;

  const urlInfo = analyzeUrl(url);
  const htmlInfo = analyzeHtml(html);
  const scores = computeScore(urlInfo, htmlInfo, { profile, sensitivity });
  const totalScore = scores.total;
  const labelInfo = riskLabel(totalScore);

  document.getElementById("scoreValue").innerText = isNaN(totalScore) ? "–" : String(totalScore);
  document.getElementById("meterFill").style.width = (isNaN(totalScore) ? 0 : totalScore) + "%";

  const tag = document.getElementById("riskTag");
  tag.textContent = labelInfo.label + " risk";
  tag.className = "risk-tag " + labelInfo.css;

  document.getElementById("httpsMeta").innerText =
    urlInfo.valid ? (urlInfo.https ? "HTTPS in use" : "No HTTPS detected") : "Unparseable URL";

  document.getElementById("domainMeta").innerText =
    "Domain: " + (urlInfo.host || "–");

  const structBits = [];
  if (urlInfo.length > 120) structBits.push("very long URL");
  if (urlInfo.length > 220) structBits.push("extremely long URL");
  if (urlInfo.hasManySubdomains) structBits.push("many subdomains");
  if (urlInfo.isIP) structBits.push("direct IP host");
  if (!structBits.length) structBits.push("no major structural flags");
  document.getElementById("structureMeta").innerText = structBits.join(", ");

  const extraBits = [];
  if (urlInfo.hasSuspiciousTLD) extraBits.push("TLD pattern flagged");
  if (urlInfo.brandHit) extraBits.push("brand-looking hostname");
  if (urlInfo.hasLoginWords) extraBits.push("login/security keywords");
  if (urlInfo.trackingParams) extraBits.push("tracking parameters");
  if (urlInfo.obfuscationFlags.length) extraBits.push("obfuscation signals");
  if (urlInfo.entropyBoost >= 10) extraBits.push("high-entropy pattern");
  if (urlInfo.hasZeroWidth || urlInfo.hasNonAsciiHost) extraBits.push("homoglyph / invisible-char risk");
  if (urlInfo.wordLikeLeet || urlInfo.brandLeetImpersonation) extraBits.push("lookalike / leet pattern");
  if (!extraBits.length) extraBits.push("no extra signals");
  document.getElementById("extrasMeta").innerText = "Signals: " + extraBits.join(" · ");

  document.getElementById("summaryText").textContent = summarize(urlInfo, htmlInfo, scores);
  document.getElementById("detailsText").innerHTML = buildDetailsText(urlInfo, htmlInfo, scores).replace(/\n/g, "<br>");
  document.getElementById("actionsText").innerHTML = buildActionsText(totalScore).replace(/\n/g, "<br>");

  document.getElementById("credMeter").style.width = (isNaN(scores.credential) ? 0 : scores.credential) + "%";
  document.getElementById("finMeter").style.width = (isNaN(scores.financial) ? 0 : scores.financial) + "%";
  document.getElementById("malMeter").style.width = (isNaN(scores.malware) ? 0 : scores.malware) + "%";
  document.getElementById("credValue").innerText = isNaN(scores.credential) ? "–" : scores.credential;
  document.getElementById("finValue").innerText = isNaN(scores.financial) ? "–" : scores.financial;
  document.getElementById("malValue").innerText = isNaN(scores.malware) ? "–" : scores.malware;

  const history = loadHistory();
  history.unshift({
    url: url || "(no URL)",
    domain: urlInfo.host || "",
    score: totalScore,
    level: labelInfo.label,
    time: new Date().toLocaleString()
  });
  if (history.length > 25) history.length = 25;
  saveHistory(history);
  renderHistory();
});
</script>

</body>
</html>
